var ASG;
(function (ASG) {
    var GalleryViewController = (function () {
        function GalleryViewController(fullscreen, timeout, galleryId) {
            this.fullscreen = fullscreen;
            this.timeout = timeout;
            this.galleryId = galleryId;
            this.help = false;
            this.gui = true;
            this.functionsVisible = false;
            this.transition = 'rotateLR';
            this.transitions = [
                'no',
                'fadeInOut',
                'zoomInOut',
                'rotateLR',
                'rotateTB',
                'rotateZY',
                'slideLR',
                'slideTB',
                'flipX',
                'flipY'
            ];
            if (this.id == undefined) {
                this.id = 'id' + this.galleryId.getNext();
            }
            this.init();
        }
        GalleryViewController.prototype.init = function () {
            var _this = this;
            if (this.visible == undefined) {
                this.visible = false;
            }
            if (this.files == undefined) {
                this.files = [];
            }
            this.timeout(function () {
                var element = '.gallery-view.' + _this.id + ' li.dropdown-submenu';
                angular.element(element).off().on('click', function (event) {
                    event.stopPropagation();
                    if (angular.element(this).hasClass('open')) {
                        angular.element(this).removeClass('open');
                    }
                    else {
                        angular.element(element).removeClass('open');
                        angular.element(this).addClass('open');
                    }
                });
                _this.setFocus();
            }, 100);
        };
        Object.defineProperty(GalleryViewController.prototype, "visible", {
            get: function () {
                return this._visible;
            },
            set: function (value) {
                this._visible = value;
                if (this._visible) {
                    this.init();
                    angular.element('body').addClass('yhidden');
                }
                else {
                    angular.element('body').removeClass('yhidden');
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GalleryViewController.prototype, "isSingle", {
            get: function () {
                return this.files.length > 1 ? false : true;
            },
            enumerable: true,
            configurable: true
        });
        GalleryViewController.prototype.setFocus = function () {
            angular.element('.gallery-view.' + this.id + ' .keyInput').trigger('focus').focus();
        };
        GalleryViewController.prototype.setTransition = function (transition) {
            this.transition = transition;
            this.setFocus();
        };
        GalleryViewController.prototype.functionsHide = function () {
            this.functionsVisible = false;
        };
        GalleryViewController.prototype.functionsShow = function () {
            this.functionsVisible = true;
        };
        GalleryViewController.prototype.downloadLink = function () {
            if (this.selected != undefined) {
                return this.baseUrl + this.files[this.selected].name;
            }
        };
        Object.defineProperty(GalleryViewController.prototype, "file", {
            get: function () {
                return this.files[this.selected];
            },
            enumerable: true,
            configurable: true
        });
        GalleryViewController.prototype.toBackward = function () {
            this.direction = 'backward';
            this.selected = this.selected == 0 ? this.files.length - 1 : this.selected - 1;
        };
        GalleryViewController.prototype.toForward = function () {
            this.direction = 'forward';
            this.selected = this.selected == this.files.length - 1 ? 0 : this.selected + 1;
        };
        GalleryViewController.prototype.toFirst = function () {
            this.direction = 'backward';
            this.selected = 0;
        };
        GalleryViewController.prototype.toLast = function () {
            this.direction = 'forward';
            this.selected = this.files.length - 1;
        };
        GalleryViewController.prototype.exit = function () {
            this.visible = false;
        };
        GalleryViewController.prototype.keyUp = function (e) {
            if (e.keyCode == 27) {
                this.exit();
            }
            if (e.keyCode == 32) {
                this.toForward();
            }
            if (e.keyCode == 37) {
                this.toBackward();
            }
            if (e.keyCode == 39) {
                this.toForward();
            }
            if (e.keyCode == 38 || e.keyCode == 36) {
                this.toFirst();
            }
            if (e.keyCode == 40 || e.keyCode == 35) {
                this.toLast();
            }
            if (e.keyCode == 70 || e.keyCode == 13) {
                this.toggleFullScreen();
            }
            if (e.keyCode == 71) {
                this.toggleGUI();
            }
            if (e.keyCode == 72) {
                this.toggleHelp();
            }
            if (e.keyCode == 84) {
                this.nextTransition();
            }
        };
        GalleryViewController.prototype.nextTransition = function () {
            var idx = this.transitions.indexOf(this.transition) + 1;
            var next = idx >= this.transitions.length ? 0 : idx;
            this.transition = this.transitions[next];
        };
        GalleryViewController.prototype.toggleFullScreen = function () {
            if (this.fullscreen.isEnabled()) {
                this.fullscreen.cancel();
            }
            else {
                this.fullscreen.all();
            }
            this.setFocus();
        };
        GalleryViewController.prototype.toggleHelp = function () {
            this.help = !this.help;
            this.setFocus();
        };
        GalleryViewController.prototype.toggleGUI = function () {
            this.gui = !this.gui;
        };
        return GalleryViewController;
    }());
    ASG.GalleryViewController = GalleryViewController;
    var GalleryIdService = (function () {
        function GalleryIdService() {
            this.id = 1;
        }
        GalleryIdService.prototype.getNext = function () {
            return this.id++;
        };
        return GalleryIdService;
    }());
    ASG.GalleryIdService = GalleryIdService;
    var app = angular.module('angularSuperGallery', ['ngAnimate']);
    app.service('galleryId', GalleryIdService);
    app.component("galleryView", {
        controller: ["Fullscreen", "$timeout", "galleryId", ASG.GalleryViewController],
        templateUrl: 'views/angular-super-gallery.html',
        bindings: {
            visible: '=',
            selected: '<',
            title: '@',
            badge: '@',
            files: '=',
            baseUrl: '@'
        }
    });
    app.provider('angularSuperGalleryOptions', function () {
        var defaults = {};
        return {
            setOpts: function (options) {
                angular.extend(defaults, options);
            },
            $get: function () {
                return defaults;
            }
        };
    });
    app.directive('imageOnload', function () {
        return {
            restrict: 'A',
            link: function (scope, element, attrs) {
                element.bind('load', function () {
                    scope.$apply(attrs.imageOnload);
                });
            }
        };
    });
    app.filter('bytes', function () {
        return function (bytes, precision) {
            if (isNaN(parseFloat(bytes)) || !isFinite(bytes))
                return '';
            if (bytes === 0)
                return '0';
            if (typeof precision === 'undefined')
                precision = 1;
            var units = ['bytes', 'kB', 'MB', 'GB', 'TB', 'PB'], number = Math.floor(Math.log(bytes) / Math.log(1024));
            return (bytes / Math.pow(1024, Math.floor(number))).toFixed(precision) + ' ' + units[number];
        };
    });
})(ASG || (ASG = {}));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hbmd1bGFyLXN1cGVyLWdhbGxlcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsSUFBTyxHQUFHLENBa1dUO0FBbFdELFdBQU8sR0FBRztJQUVOO1FBZ0NJLCtCQUFvQixVQUFVLEVBQ1YsT0FBTyxFQUNQLFNBQVM7WUFGVCxlQUFVLEdBQVYsVUFBVSxDQUFBO1lBQ1YsWUFBTyxHQUFQLE9BQU8sQ0FBQTtZQUNQLGNBQVMsR0FBVCxTQUFTLENBQUE7WUExQnRCLFNBQUksR0FBYSxLQUFLLENBQUM7WUFDdkIsUUFBRyxHQUFhLElBQUksQ0FBQztZQU1wQixxQkFBZ0IsR0FBYSxLQUFLLENBQUM7WUFDbkMsZUFBVSxHQUFZLFVBQVUsQ0FBQztZQUNqQyxnQkFBVyxHQUFtQjtnQkFDbEMsSUFBSTtnQkFDSixXQUFXO2dCQUNYLFdBQVc7Z0JBQ1gsVUFBVTtnQkFDVixVQUFVO2dCQUNWLFVBQVU7Z0JBQ1YsU0FBUztnQkFDVCxTQUFTO2dCQUNULE9BQU87Z0JBQ1AsT0FBTzthQUNWLENBQUM7WUFRRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZCLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDOUMsQ0FBQztZQUVELElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVoQixDQUFDO1FBR08sb0NBQUksR0FBWjtZQUFBLGlCQTZCQztZQTNCRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO1lBQ3pCLENBQUM7WUFFRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1lB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c3VwZXItZ2FsbGVyeS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cclxuXHJcbm1vZHVsZSBBU0cge1xyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBHYWxsZXJ5Vmlld0NvbnRyb2xsZXIge1xyXG5cclxuICAgICAgICBwdWJsaWMgdGl0bGUgOiBzdHJpbmc7XHJcbiAgICAgICAgcHVibGljIGJhZGdlIDogc3RyaW5nO1xyXG4gICAgICAgIHB1YmxpYyBmaWxlcyA6IGFueTtcclxuICAgICAgICBwdWJsaWMgc2VsZWN0ZWQgOiBudW1iZXI7XHJcbiAgICAgICAgcHVibGljIGJhc2VVcmwgOiBzdHJpbmc7XHJcbiAgICAgICAgcHVibGljIGRpcmVjdGlvbiA6IHN0cmluZztcclxuICAgICAgICBwdWJsaWMgaGVscCA6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgZ3VpIDogYm9vbGVhbiA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIGlkIDogc3RyaW5nO1xyXG5cclxuICAgICAgICBwcml2YXRlIF92aXNpYmxlIDogYm9vbGVhbjtcclxuICAgICAgICBwcml2YXRlIF9mdWxsc2NyZWVuIDogYm9vbGVhbjtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBmdW5jdGlvbnNWaXNpYmxlIDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgICAgIHByaXZhdGUgdHJhbnNpdGlvbiA6IHN0cmluZyA9ICdyb3RhdGVMUic7XHJcbiAgICAgICAgcHJpdmF0ZSB0cmFuc2l0aW9ucyA6IEFycmF5PHN0cmluZz4gPSBbXHJcbiAgICAgICAgICAgICdubycsXHJcbiAgICAgICAgICAgICdmYWRlSW5PdXQnLFxyXG4gICAgICAgICAgICAnem9vbUluT3V0JyxcclxuICAgICAgICAgICAgJ3JvdGF0ZUxSJyxcclxuICAgICAgICAgICAgJ3JvdGF0ZVRCJyxcclxuICAgICAgICAgICAgJ3JvdGF0ZVpZJyxcclxuICAgICAgICAgICAgJ3NsaWRlTFInLFxyXG4gICAgICAgICAgICAnc2xpZGVUQicsXHJcbiAgICAgICAgICAgICdmbGlwWCcsXHJcbiAgICAgICAgICAgICdmbGlwWSdcclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICAvL3Byb3RlY3RlZCBpbmZvVmlzaWJsZSA6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgY29uc3RydWN0b3IocHJpdmF0ZSBmdWxsc2NyZWVuLFxyXG4gICAgICAgICAgICAgICAgICAgIHByaXZhdGUgdGltZW91dCxcclxuICAgICAgICAgICAgICAgICAgICBwcml2YXRlIGdhbGxlcnlJZCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuaWQgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlkID0gJ2lkJyArIHRoaXMuZ2FsbGVyeUlkLmdldE5leHQoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5pbml0KCk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgZ2FsbGVyeVxyXG4gICAgICAgIHByaXZhdGUgaW5pdCgpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnZpc2libGUgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZmlsZXMgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGVzID0gW107XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMudGltZW91dCgoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc3VibWVudSBjbGljayBldmVudHNcclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJy5nYWxsZXJ5LXZpZXcuJyArIHRoaXMuaWQgKyAnIGxpLmRyb3Bkb3duLXN1Ym1lbnUnO1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGVsZW1lbnQpLm9mZigpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmVsZW1lbnQodGhpcykuaGFzQ2xhc3MoJ29wZW4nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQodGhpcykucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZWxlbWVudCkucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KHRoaXMpLmFkZENsYXNzKCdvcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGZvY3VzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZvY3VzKCk7XHJcblxyXG4gICAgICAgICAgICB9LCAxMDApO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGdldCB2aXNpYmxlXHJcbiAgICAgICAgcHVibGljIGdldCB2aXNpYmxlKCkge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Zpc2libGU7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gc2V0IHZpc2libGVcclxuICAgICAgICBwdWJsaWMgc2V0IHZpc2libGUodmFsdWUgOiBib29sZWFuKSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl92aXNpYmxlID0gdmFsdWU7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fdmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJ2JvZHknKS5hZGRDbGFzcygneWhpZGRlbicpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCdib2R5JykucmVtb3ZlQ2xhc3MoJ3loaWRkZW4nKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGlzIHNpbmdsZT9cclxuICAgICAgICBwdWJsaWMgZ2V0IGlzU2luZ2xlKCkge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZXMubGVuZ3RoID4gMSA/IGZhbHNlIDogdHJ1ZTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBzZXQgdGhlIGZvY3VzXHJcbiAgICAgICAgcHVibGljIHNldEZvY3VzKCkge1xyXG5cclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcuZ2FsbGVyeS12aWV3LicgKyB0aGlzLmlkICsgJyAua2V5SW5wdXQnKS50cmlnZ2VyKCdmb2N1cycpLmZvY3VzKCk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gc2V0IHRyYW5zaXRpb24gZWZmZWN0XHJcbiAgICAgICAgcHVibGljIHNldFRyYW5zaXRpb24odHJhbnNpdGlvbikge1xyXG5cclxuICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uID0gdHJhbnNpdGlvbjtcclxuICAgICAgICAgICAgdGhpcy5zZXRGb2N1cygpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIG92ZXJsYXkgYXJyb3dzIGhpZGVcclxuICAgICAgICBwdWJsaWMgZnVuY3Rpb25zSGlkZSgpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZnVuY3Rpb25zVmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIG92ZXJsYXkgYXJyb3dzIHNob3dcclxuICAgICAgICBwdWJsaWMgZnVuY3Rpb25zU2hvdygpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZnVuY3Rpb25zVmlzaWJsZSA9IHRydWU7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZ2V0IHRoZSBkb3dubG9hZCBsaW5rXHJcbiAgICAgICAgcHVibGljIGRvd25sb2FkTGluaygpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmFzZVVybCArIHRoaXMuZmlsZXNbdGhpcy5zZWxlY3RlZF0ubmFtZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGdldCB0aGUgZmlsZVxyXG4gICAgICAgIHB1YmxpYyBnZXQgZmlsZSgpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGVzW3RoaXMuc2VsZWN0ZWRdO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIGJhY2t3YXJkXHJcbiAgICAgICAgcHVibGljIHRvQmFja3dhcmQoKSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdiYWNrd2FyZCc7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkID09IDAgPyB0aGlzLmZpbGVzLmxlbmd0aCAtIDEgOiB0aGlzLnNlbGVjdGVkIC0gMTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBnbyB0byBmb3J3YXJkXHJcbiAgICAgICAgcHVibGljIHRvRm9yd2FyZCgpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2ZvcndhcmQnO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZCA9PSB0aGlzLmZpbGVzLmxlbmd0aCAtIDEgPyAwIDogdGhpcy5zZWxlY3RlZCArIDE7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZ28gdG8gZmlyc3RcclxuICAgICAgICBwdWJsaWMgdG9GaXJzdCgpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ2JhY2t3YXJkJztcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IDA7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZ28gdG8gbGFzdFxyXG4gICAgICAgIHB1YmxpYyB0b0xhc3QoKSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICdmb3J3YXJkJztcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHRoaXMuZmlsZXMubGVuZ3RoIC0gMTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBleGl0XHJcbiAgICAgICAgcHVibGljIGV4aXQoKSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBrZXltYXBcclxuICAgICAgICBwdWJsaWMga2V5VXAoZSkge1xyXG5cclxuICAgICAgICAgICAgLy8gZXNjXHJcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT0gMjcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBzcGFjZVxyXG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDMyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvRm9yd2FyZCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBsZWZ0XHJcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT0gMzcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9CYWNrd2FyZCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyByaWdodFxyXG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDM5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvRm9yd2FyZCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyB1cFxyXG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDM4IHx8IGUua2V5Q29kZSA9PSAzNikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50b0ZpcnN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGRvd25cclxuICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PSA0MCB8fCBlLmtleUNvZGUgPT0gMzUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9MYXN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGYgLSBmdWxsc2NyZWVuXHJcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT0gNzAgfHwgZS5rZXlDb2RlID09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZUZ1bGxTY3JlZW4oKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gZyAtIGd1aVxyXG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDcxKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZUdVSSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBoIC0gaGVscFxyXG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDcyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZUhlbHAoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gdCAtIHRyYW5zaXRpb24gbmV4dFxyXG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDg0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5leHRUcmFuc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBzd2l0Y2ggdG8gbmV4dCB0cmFuc2l0aW9uIGVmZmVjdFxyXG4gICAgICAgIHByaXZhdGUgbmV4dFRyYW5zaXRpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgaWR4ID0gdGhpcy50cmFuc2l0aW9ucy5pbmRleE9mKHRoaXMudHJhbnNpdGlvbikgKyAxO1xyXG4gICAgICAgICAgICB2YXIgbmV4dCA9IGlkeCA+PSB0aGlzLnRyYW5zaXRpb25zLmxlbmd0aCA/IDAgOiBpZHg7XHJcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvbiA9IHRoaXMudHJhbnNpdGlvbnNbbmV4dF07XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdG9nZ2xlIGZ1bGxzY3JlZW5cclxuICAgICAgICBwcml2YXRlIHRvZ2dsZUZ1bGxTY3JlZW4oKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5mdWxsc2NyZWVuLmlzRW5hYmxlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZ1bGxzY3JlZW4uY2FuY2VsKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZ1bGxzY3JlZW4uYWxsKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zZXRGb2N1cygpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRvZ2dsZSBoZWxwXHJcbiAgICAgICAgcHJpdmF0ZSB0b2dnbGVIZWxwKCkge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5oZWxwID0gIXRoaXMuaGVscDtcclxuICAgICAgICAgICAgdGhpcy5zZXRGb2N1cygpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRvZ2dsZSBHVUlcclxuICAgICAgICBwcml2YXRlIHRvZ2dsZUdVSSgpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZ3VpID0gIXRoaXMuZ3VpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8vIGdhbGxlcnkgdW5pcXVlIGlkIHNlcnZpY2VcclxuICAgIGV4cG9ydCBjbGFzcyBHYWxsZXJ5SWRTZXJ2aWNlIHtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBpZCA9IDE7XHJcblxyXG4gICAgICAgIHB1YmxpYyBnZXROZXh0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pZCsrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG5cclxuICAgIHZhciBhcHAgOiBuZy5JTW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FuZ3VsYXJTdXBlckdhbGxlcnknLCBbJ25nQW5pbWF0ZSddKTtcclxuXHJcbiAgICBhcHAuc2VydmljZSgnZ2FsbGVyeUlkJywgR2FsbGVyeUlkU2VydmljZSk7XHJcblxyXG4gICAgYXBwLmNvbXBvbmVudChcImdhbGxlcnlWaWV3XCIsIHtcclxuICAgICAgICBjb250cm9sbGVyOiBbXCJGdWxsc2NyZWVuXCIsIFwiJHRpbWVvdXRcIiwgXCJnYWxsZXJ5SWRcIiwgQVNHLkdhbGxlcnlWaWV3Q29udHJvbGxlcl0sXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9hbmd1bGFyLXN1cGVyLWdhbGxlcnkuaHRtbCcsXHJcbiAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgdmlzaWJsZTogJz0nLFxyXG4gICAgICAgICAgICBzZWxlY3RlZDogJzwnLFxyXG4gICAgICAgICAgICB0aXRsZTogJ0AnLFxyXG4gICAgICAgICAgICBiYWRnZTogJ0AnLFxyXG4gICAgICAgICAgICBmaWxlczogJz0nLFxyXG4gICAgICAgICAgICBiYXNlVXJsOiAnQCdcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBhcHAucHJvdmlkZXIoJ2FuZ3VsYXJTdXBlckdhbGxlcnlPcHRpb25zJywgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICB2YXIgZGVmYXVsdHMgPSB7fTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2V0T3B0czogZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGRlZmF1bHRzLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIGFwcC5kaXJlY3RpdmUoJ2ltYWdlT25sb2FkJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMgOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnbG9hZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoYXR0cnMuaW1hZ2VPbmxvYWQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXBwLmZpbHRlcignYnl0ZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChieXRlcyA6IGFueSwgcHJlY2lzaW9uIDogbnVtYmVyKSA6IHN0cmluZyB7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNOYU4ocGFyc2VGbG9hdChieXRlcykpIHx8ICFpc0Zpbml0ZShieXRlcykpIHJldHVybiAnJ1xyXG4gICAgICAgICAgICBpZiAoYnl0ZXMgPT09IDApIHJldHVybiAnMCc7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcHJlY2lzaW9uID09PSAndW5kZWZpbmVkJykgcHJlY2lzaW9uID0gMTtcclxuXHJcbiAgICAgICAgICAgIHZhciB1bml0cyA9IFsnYnl0ZXMnLCAna0InLCAnTUInLCAnR0InLCAnVEInLCAnUEInXSxcclxuICAgICAgICAgICAgICAgIG51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5sb2coYnl0ZXMpIC8gTWF0aC5sb2coMTAyNCkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIChieXRlcyAvIE1hdGgucG93KDEwMjQsIE1hdGguZmxvb3IobnVtYmVyKSkpLnRvRml4ZWQocHJlY2lzaW9uKSArICcgJyArIHVuaXRzW251bWJlcl07XHJcblxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuXHJcbn1cclxuXHJcbiJdfQ==
